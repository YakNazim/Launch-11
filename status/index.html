<!doctype html>
<html>
<head>
  <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <style>
    html, body {
        width: 100%;
        height: 80%;
        margin: 0;
    }

    .chart {
        font-family: Arial, sans-serif;
        font-size: 12px;
    }

    .axis path,.axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }

    .bar {
        fill: #33b5e5;
    }

    .bar-failed {
        fill: #CC0000;
    }

    .bar-running {
        fill: #669900;
    }

    .bar-succeeded {
        fill: #33b5e5;
    }

    .bar-killed {
        fill: #ffbb33;
    }
  </style
</head>
</head>
<body>
  <h1>Launch Milestones</h1>
  <hr>
  <script src="gantt-chart-d3.js"></script>
  <script>
    var taskStatus = {
        "WORKING" : "bar-running",
        "NOTSTARTED" : "bar-killed"
    };
    
    $.getJSON( "https://api.github.com/repos/psas/Launch-11/milestones", function (data) {
        var milestone, _i, _len, prevdate, enddate, status;

        tasks = [];
        taskNames = [];
        prevdate = new Date();

        for (_i = 0, _len = data.length; _i < _len; _i++) {
            milestone = data[_i];
            enddate = new Date(milestone.due_on);
            status = "WORKING"
            if (milestone.open_issues < 1) {
                status = "NOTSTARTED"
            }

            tasks.push({
                "startDate": prevdate,
                "endDate": enddate,
                "taskName": milestone.title,
                "status": status
            });

            taskNames.push(milestone.title);

            prevdate = enddate;
        }
        var maxDate = tasks[tasks.length - 1].endDate;
        tasks.sort(function(a, b) {
            return a.startDate - b.startDate;
        });
        var minDate = tasks[0].startDate;

        var format = "%b/%m";

        var gantt = d3.gantt().taskTypes(taskNames).taskStatus(taskStatus).tickFormat(format);
        gantt(tasks);
        
        /*console.log(tasks);
        console.log(taskNames);*/
    });
  </script>
</body>
</html>
